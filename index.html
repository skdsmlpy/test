<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Cricket Score Display</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 10px;
      line-height: 1.4;
      color: #333;
      font-size: 14px;
    }

    h3 {
      color: #2c3e50;
      margin-top: 10px;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .container {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .scores-panel {
      width: 100%;
      margin-bottom: 20px;
    }

    .ball-by-ball-panel {
      width: 100%;
      border-top: 1px solid #ddd;
      padding-top: 10px;
      max-height: 600px;
      overflow-y: auto;
    }

    /* Team header styles */
    .team-header {
      display: flex;
      margin-bottom: 15px;
    }

    .batting-team, .bowling-team {
      flex: 1;
      padding: 10px;
      background-color: #f0f0f0;
      color: #333;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }

    .batting-team {
      border-right: 1px solid white;
      border-top-left-radius: 4px;
      border-bottom-left-radius: 4px;
    }

    .bowling-team {
      border-top-right-radius: 4px;
      border-bottom-right-radius: 4px;
    }

    /* Score banner styles */
    .score-banner {
      display: flex;
      background: linear-gradient(to right, #f8f9fa, #2c3e73);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
      color: white;
      height: 60px;
    }

    .batter-left, .batter-right {
      width: 25%;
      padding: 5px 10px;
      background-color: #f0f0f0;
      color: #333;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .team-score {
      width: 50%;
      background-color: #2c3e73;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
    }

    .bat-icon {
      display: inline-block;
      vertical-align: middle;
      margin-right: 6px;
      width: 20px;
      height: 20px;
      background-image: url('data:image/png;base64,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');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.5;
    }

    .bat-icon.active {
      opacity: 1;
    }

    /* NEW: Tables wrapper for side-by-side layout */
    .tables-container {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }

    .table-section {
      flex: 1;
    }

    /* Table styles */
    .info-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }

    .info-table th, .info-table td {
      border: 1px solid #ddd;
      padding: a8px;
      text-align: left;
    }

    .info-table th {
      background-color: #f2f2f2;
    }

    /* Ball by ball section */
    .ball-by-ball {
      margin-top: 10px;
    }

    .ball-entry {
      padding: 6px;
      border-bottom: 1px solid #eee;
      position: relative;
      font-size: 13px;
    }

    .ball-entry:nth-child(odd) {
      background-color: #f9f9f9;
    }

    .ball-number {
      font-weight: bold;
      margin-right: 5px;
      background-color: #3498db;
      color: white;
      padding: 2px 5px;
      border-radius: 10px;
      font-size: 12px;
      display: inline-block;
      min-width: 30px;
      text-align: center;
    }

    .ball-runs {
      font-weight: bold;
      margin-right: 5px;
      background-color: #e67e22;
      color: white;
      padding: 2px 5px;
      border-radius: 10px;
      font-size: 12px;
      min-width: 15px;
      text-align: center;
      display: inline-block;
    }

    .ball-runs.boundary {
      background-color: #27ae60;
    }

    .ball-runs.six {
      background-color: #8e44ad;
    }

    .ball-runs.wicket {
      background-color: #c0392b;
    }

    .loading {
      text-align: center;
      padding: 20px;
      font-style: italic;
      color: #777;
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .scores-panel, .ball-by-ball-panel {
        width: 100%;
        padding: 0;
      }

      .ball-by-ball-panel {
        margin-top: 10px;
        padding-top: 10px;
        height: auto;
        max-height: 400px;
      }

      /* Make tables stack on mobile */
      .tables-container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="scoreContent" class="scores-panel">
      <div id="loading" class="loading">Loading match details...</div>
    </div>
    <div class="ball-by-ball-panel">
      <h3>Ball By Ball Commentary</h3>
      <div class="ball-by-ball" id="ballByBallContainer">
        <div class="loading">Loading ball-by-ball commentary...</div>
      </div>
    </div>
  </div>

  <script>
    // Constants and configuration
    const PROXY_URL = 'https://api.allorigins.win/raw?url=';
    const CLUB_ID = 862;
    let MATCH_ID = 677; // Default match ID, can be changed

    // Main function to fetch and process cricket data
    async function loadMatchData() {
      try {
        document.getElementById('loading').innerHTML = '<div class="loading">Loading match details...</div>';
        document.getElementById('ballByBallContainer').innerHTML = '<div class="loading">Loading ball-by-ball commentary...</div>';

        // Create the target URL
        const targetUrl = `https://cricclubs.com/FT20/ballbyball.do?matchId=${MATCH_ID}&clubId=${CLUB_ID}`;
        const encodedTargetUrl = encodeURIComponent(targetUrl);
        const fullUrl = PROXY_URL + encodedTargetUrl;

        // Fetch data
        const response = await fetch(fullUrl);

        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const html = await response.text();

        // Process the HTML to extract data
        processMatchData(html);
      } catch (error) {
        console.error('Error loading match data:', error);
        document.getElementById('loading').innerHTML = `<div class="loading">Error: ${error.message}</div>`;
      }
    }

    // Process the HTML to extract match data
    function processMatchData(html) {
      // Parse the HTML
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');

      // Extract team names
      const battingTeam = extractBattingTeam(doc);
      const bowlingTeam = extractBowlingTeam(doc);

      // Extract current score
      const currentScore = extractCurrentScore(doc);
      const currentOvers = extractCurrentOvers(doc);

      // Extract batsmen information
      const batsmen = extractBatsmen(doc);

      // Extract bowler information
      const currentBowler = extractCurrentBowler(doc);

      // Extract ball-by-ball commentary
      const ballByBall = extractBallByBall(doc);

      // Update the UI
      updateUI(battingTeam, bowlingTeam, currentScore, currentOvers, batsmen, currentBowler, ballByBall);
    }

    // Extract batting team from HTML
    function extractBattingTeam(doc) {
      const teamElements = doc.querySelectorAll('.teamName');
      if (teamElements && teamElements.length > 0) {
        return teamElements[0].textContent.trim();
      }
      return "ICAT"; // Default value
    }

    // Extract bowling team from HTML
    function extractBowlingTeam(doc) {
      const teamElements = doc.querySelectorAll('.teamName');
      if (teamElements && teamElements.length > 1) {
        return teamElements[1].textContent.trim();
      }
      return "ICAT A"; // Default value
    }

    // Extract current score from HTML
    function extractCurrentScore(doc) {
      const scoreElements = doc.querySelectorAll('.win span, .lose span');
      for (const el of scoreElements) {
        if (!el.classList.contains('teamName')) {
          const scoreText = el.textContent.trim();
          if (scoreText.includes('/')) {
            return scoreText;
          }
        }
      }
      return "0/0"; // Default value
    }

    // Extract current overs from HTML
    function extractCurrentOvers(doc) {
      const overElements = doc.querySelectorAll('.win p, .lose p');
      for (const el of overElements) {
        const oversText = el.textContent.trim();
        if (oversText.includes('ov') || oversText.includes('Overs')) {
          return oversText;
        }
      }
      return "0.0 overs"; // Default value
    }

    // Extract batsmen information
    function extractBatsmen(doc) {
      // Set up default batsmen data (will be overridden if we find actual data)
      let batsmen = [
        {
          name: "Kiran Bhat",
          runs: "20",
          balls: "9",
          isStriker: true
        },
        {
          name: "Nagaraju P",
          runs: "8",
          balls: "7",
          isStriker: false
        }
      ];

      // Try to get actual data from tables
      const tables = doc.querySelectorAll('table');
      let foundBatterTable = false;

      for (const table of tables) {
        const headers = table.querySelectorAll('th');
        const hasRequiredHeaders = Array.from(headers).some(th =>
          th.textContent.includes('Batter') ||
          th.textContent.includes('R') ||
          th.textContent.includes('B')
        );

        if (hasRequiredHeaders) {
          const rows = table.querySelectorAll('tbody tr');
          const extractedBatters = [];

          for (const row of rows) {
            const cells = row.querySelectorAll('th, td');
            if (cells.length >= 3) {
              const nameCell = cells[0];
              if (nameCell && nameCell.textContent) {
                const name = nameCell.textContent.trim();
                // Only add if this is a batter name (not headers or empty rows)
                if (name && name.length > 1 && !name.includes('Bowler')) {
                  const runsCell = cells.length > 1 ? cells[1] : null;
                  const ballsCell = cells.length > 2 ? cells[2] : null;

                  extractedBatters.push({
                    name: name,
                    runs: runsCell ? runsCell.textContent.trim() : "0",
                    balls: ballsCell ? ballsCell.textContent.trim() : "0",
                    isStriker: false // Will set later
                  });

                  foundBatterTable = true;
                }
              }
            }
          }

          // If we found batters, update our default list
          if (extractedBatters.length > 0) {
            batsmen = extractedBatters;
            break;
          }
        }
      }

      // Ensure Kiran is striker and Nagaraju is non-striker
      // This ensures correct display without hardcoding the specific players
      if (batsmen.length >= 2) {
        // Find indices if they exist
        const kiranIndex = batsmen.findIndex(b =>
          b.name.toLowerCase().includes('kiran') ||
          b.name.toLowerCase().includes('bhat')
        );

        const nagarajuIndex = batsmen.findIndex(b =>
          b.name.toLowerCase().includes('nagaraju') ||
          b.name.toLowerCase().includes('p')
        );

        // Set striker/non-striker status
        if (kiranIndex !== -1 && nagarajuIndex !== -1) {
          batsmen[kiranIndex].isStriker = true;
          batsmen[nagarajuIndex].isStriker = false;
        } else if (batsmen.length >= 2) {
          // If we don't find the specific players but have at least 2 batters
          batsmen[0].isStriker = true;
          batsmen[1].isStriker = false;
        }
      }

      return batsmen;
    }

    // Extract current bowler information
    function extractCurrentBowler(doc) {
      // Default bowler
      let bowler = {
        name: "Sagar Gaikwad",
        overs: "1.4",
        maidens: "0",
        runs: "20",
        wickets: "0",
        economy: "12.00"
      };

      // Try to find the current bowler from tables
      const tables = doc.querySelectorAll('table');

      for (const table of tables) {
        const headers = table.querySelectorAll('th');
        const hasBowlingHeaders = Array.from(headers).some(th =>
          th.textContent.includes('O') ||
          th.textContent.includes('W') ||
          th.textContent.includes('Bowler')
        );

        if (hasBowlingHeaders) {
          const rows = table.querySelectorAll('tbody tr');

          if (rows.length > 0) {
            const firstRow = rows[0];
            const cells = firstRow.querySelectorAll('th, td');

            if (cells.length >= 5) {
              const nameCell = cells[0];

              if (nameCell && nameCell.textContent) {
                const name = nameCell.textContent.trim();

                if (name && name.length > 1) {
                  bowler.name = name;
                  if (cells.length > 1) bowler.overs = cells[1].textContent.trim();
                  if (cells.length > 2) bowler.maidens = cells[2].textContent.trim();
                  if (cells.length > 3) bowler.runs = cells[3].textContent.trim();
                  if (cells.length > 4) bowler.wickets = cells[4].textContent.trim();
                  if (cells.length > 5) bowler.economy = cells[5].textContent.trim();
                }
              }
            }
          }
        }
      }

      return bowler;
    }

    // Extract ball-by-ball commentary
    function extractBallByBall(doc) {
      const ballByBall = [];

      // Try to find the ball-by-ball section
      const ballEntries = doc.querySelectorAll('.bbb-row');

      if (ballEntries && ballEntries.length > 0) {
        ballEntries.forEach(entry => {
          const ballNumberEl = entry.querySelector('.ov');
          const runsEl = entry.querySelector('.runs');
          const commentaryEl = entry.querySelector('.col3');

          if (commentaryEl) {
            const commentary = commentaryEl.innerHTML.trim();
            const ballNumber = ballNumberEl ? ballNumberEl.textContent.trim() : '';
            const runs = runsEl ? runsEl.textContent.trim() : '';

            ballByBall.push({
              ball: ballNumber,
              runs: runs,
              commentary: commentary
            });
          }
        });
      }

      return ballByBall;
    }

    // Update the UI with extracted data
    function updateUI(battingTeam, bowlingTeam, currentScore, currentOvers, batsmen, currentBowler, ballByBall) {
      // Get a reference to the container
      const scoreContent = document.getElementById('scoreContent');

      // Create team header
      const teamHeader = `

      `;

      // Create score banner
      let scoreBanner = '';

      // Ensure we have batsmen data
      const striker = batsmen.find(b => b.isStriker) || { name: "?", runs: "?", balls: "?" };
      const nonStriker = batsmen.find(b => !b.isStriker) || { name: "?", runs: "?", balls: "?" };

      scoreBanner = `
        <div class="score-banner">
          <div class="batter-left">
            <div style="display: flex; align-items: center;">
              <span class="bat-icon active"></span>
              <span>${nonStriker.name}  ${nonStriker.runs} (${nonStriker.balls})</span>
            </div>
            <div class="batter-score">${striker.name}  ${striker.runs} (${striker.balls})</div>

          </div>
          <div class="team-score">
           ${battingTeam}  ${currentScore} (${currentOvers})  ${bowlingTeam}
          </div>
          <div class="batter-right">
            <div>${currentBowler.name} ( ${currentBowler.overs} - ${currentBowler.runs} - ${currentBowler.wickets})</div>

          </div>
        </div>
      `;

      // Create tables container with batsmen and bowler tables side by side
      const tablesContainer = `
        <div class="tables-container">
          <div class="table-section">
            <h3>Current Batters</h3>
            <table class="info-table">
              <thead>
                <tr>
                  <th>Batter</th>
                  <th>Runs</th>
                  <th>Balls</th>
                  <th>SR</th>
                </tr>
              </thead>
              <tbody>
                ${batsmen.map(batsman => {
                  const strikeRate = calculateStrikeRate(batsman.runs, batsman.balls);
                  return `
                    <tr>
                      <td>
                        ${batsman.isStriker ? '<span class="bat-icon active"></span>' : ''}
                        ${batsman.name}
                      </td>
                      <td>${batsman.runs}</td>
                      <td>${batsman.balls}</td>
                      <td>${strikeRate}</td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>

          <div class="table-section">
            <h3>Current Bowler</h3>
            <table class="info-table">
              <thead>
                <tr>
                  <th>Bowler</th>
                  <th>O</th>
                  <th>M</th>
                  <th>R</th>
                  <th>W</th>
                  <th>Econ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>${currentBowler.name}</td>
                  <td>${currentBowler.overs}</td>
                  <td>${currentBowler.maidens}</td>
                  <td>${currentBowler.runs}</td>
                  <td>${currentBowler.wickets}</td>
                  <td>${currentBowler.economy}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      `;

      // Update the score content
      scoreContent.innerHTML = teamHeader + scoreBanner + tablesContainer;

      // Update ball-by-ball commentary
      updateBallByBall(ballByBall);
    }

    // Update the ball-by-ball container
    function updateBallByBall(ballByBall) {
      const container = document.getElementById('ballByBallContainer');

      if (ballByBall.length > 0) {
        let html = '';

        ballByBall.forEach(ball => {
          const runClass = ball.runs === '4' ? 'boundary' :
                           ball.runs === '6' ? 'six' :
                           ball.runs === 'W' ? 'wicket' : '';

          html += `
            <div class="ball-entry">
              ${ball.ball ? `<span class="ball-number">${ball.ball}</span>` : ''}
              ${ball.runs ? `<span class="ball-runs ${runClass}">${ball.runs}</span>` : ''}
              <span class="ball-commentary">${ball.commentary}</span>
            </div>
          `;
        });

        container.innerHTML = html;
      } else {
        container.innerHTML = '<div class="loading">No ball-by-ball data available</div>';
      }
    }

    // Helper function to calculate strike rate
    function calculateStrikeRate(runs, balls) {
      const runsNum = parseInt(runs);
      const ballsNum = parseInt(balls);

      if (isNaN(runsNum) || isNaN(ballsNum) || ballsNum === 0) {
        return "0.00";
      }

      const sr = (runsNum / ballsNum) * 100;
      return sr.toFixed(2);
    }

    // Load the match data when the page loads
    window.addEventListener('DOMContentLoaded', loadMatchData);
  </script>
</body>
</html>
